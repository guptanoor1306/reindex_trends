<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>re-indexer - Video Repackaging POC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 10px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.1em;
        }
        
        .section {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        button:hover:not(:disabled) {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .trend-list {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }
        
        .trend-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: start;
            gap: 12px;
        }
        
        .trend-item:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }
        
        .trend-item.selected {
            border-color: #667eea;
            background: #e8edff;
        }
        
        .trend-checkbox {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }
        
        .trend-content {
            flex: 1;
        }
        
        .trend-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #333;
        }
        
        .trend-meta {
            font-size: 0.9em;
            color: #666;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            opacity: 0.9;
        }
        
        .result-item {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .score-badges {
            display: flex;
            gap: 10px;
        }
        
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .titles-list {
            margin-top: 10px;
        }
        
        .title-option {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: white;
            color: #667eea;
        }
        
        .nav-btn.active {
            background: white;
            color: #667eea;
        }
        
        .collapsible-section {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chevron {
            transition: transform 0.3s;
            font-size: 1.2em;
        }
        
        .chevron.expanded {
            transform: rotate(90deg);
        }
        
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .collapsible-content.expanded {
            max-height: 2000px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üé¨ re-indexer</h1>
            <p class="subtitle">AI-Powered Video Repackaging for Trending Topics</p>
            <div class="nav-buttons">
                <a href="/" class="nav-btn active">üìà News Trends</a>
                <a href="/shorts.html" class="nav-btn">üéØ Re-index Shorts</a>
            </div>
        </header>
        
        <!-- Step 1: Fetch Trends -->
        <div class="section" id="fetchTrendsSection">
            <h2><span class="step-number">1</span> Fetch Trending Topics</h2>
            <p style="margin-bottom: 15px;">Fetch the latest trending topics from Google News India (All Categories)</p>
            <button id="fetchTrendsBtn" onclick="fetchTrends()">üîÑ Fetch Trends</button>
            <div id="fetchStatus"></div>
            
            <!-- Manual Trend Input - Collapsible -->
            <div style="margin-top: 30px; padding-top: 25px; border-top: 2px dashed #e0e0e0;">
                <div class="collapsible-section" onclick="toggleSection('manualTrendSection')">
                    <span class="chevron" id="manualTrendSectionChevron">‚ñ∂</span>
                    <h3 style="margin: 0 0 0 0; color: #764ba2; font-size: 1.1em;">‚úçÔ∏è Or Add a Manual Trend</h3>
                </div>
                <div class="collapsible-content" id="manualTrendSection">
                    <p style="margin: 15px 0 15px 0; color: #666; font-size: 0.95em;">Know something trending that News didn't catch? Add it manually.</p>
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">Trend Title <span style="color: red;">*</span></label>
                            <input type="text" id="manualTrendTitle" placeholder="e.g., Budget 2026 Slabs, AI Layoffs in Tech" 
                                   style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em; transition: border-color 0.3s;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">Description <span style="color: #999;">(optional)</span></label>
                            <textarea id="manualTrendDescription" placeholder="Brief description or context about this trend..." rows="3"
                                      style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em; resize: vertical; font-family: inherit; transition: border-color 0.3s;"></textarea>
                        </div>
                        <div>
                            <button onclick="addManualTrend()" style="background: #764ba2;">‚ûï Add Manual Trend</button>
                            <span id="manualTrendStatus" style="margin-left: 15px; font-size: 0.9em;"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Step 2: Select Trends -->
        <div class="section" id="selectTrendsSection">
            <h2><span class="step-number">2</span> Select Relevant Trends</h2>
            <p style="margin-bottom: 15px;">Choose which trends are relevant for your channel</p>
            <div id="trendsContainer">
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>No trends fetched yet. Click "Fetch Trends" above to begin.</p>
                </div>
            </div>
            <div class="action-buttons" id="trendActions" style="display: none;">
                <button onclick="selectAll()">‚úì Select All</button>
                <button class="btn-secondary" onclick="deselectAll()">‚úó Deselect All</button>
                <button onclick="matchSelected()" id="matchBtn" style="margin-left: auto;">‚ñ∂Ô∏è Match Selected Trends</button>
            </div>
        </div>
        
        <!-- Step 3: Results -->
        <div class="section" id="resultsSection" style="display: none;">
            <h2><span class="step-number">3</span> Recommendations</h2>
            <div class="stats" id="statsContainer"></div>
            <div id="resultsContainer"></div>
        </div>
    </div>

    <script>
        let trends = [];
        let selectedTrendIds = new Set();
        
        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const chevron = document.getElementById(sectionId + 'Chevron');
            
            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                chevron.classList.remove('expanded');
            } else {
                content.classList.add('expanded');
                chevron.classList.add('expanded');
            }
        }
        
        // Format view count properly
        function formatViews(views) {
            if (views >= 1000000) {
                return (views / 1000000).toFixed(1) + 'M';
            } else if (views >= 1000) {
                return (views / 1000).toFixed(1) + 'K';
            } else {
                return views.toLocaleString();
            }
        }
        
        async function fetchTrends() {
            const btn = document.getElementById('fetchTrendsBtn');
            const status = document.getElementById('fetchStatus');
            
            btn.disabled = true;
            status.innerHTML = '<div class="loading"><div class="spinner"></div><p>Fetching trends from Google News...</p></div>';
            
            try {
                const response = await fetch('/api/fetch-trends', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    trends = data.trends;
                    displayTrends();
                    status.innerHTML = '<p style="color: green; margin-top: 15px;">‚úÖ Fetched ' + trends.length + ' trends successfully!</p>';
                } else {
                    status.innerHTML = '<p style="color: red; margin-top: 15px;">‚ùå Error: ' + data.error + '</p>';
                }
            } catch (error) {
                status.innerHTML = '<p style="color: red; margin-top: 15px;">‚ùå Error: ' + error.message + '</p>';
            }
            
            btn.disabled = false;
        }
        
        async function addManualTrend() {
            const titleInput = document.getElementById('manualTrendTitle');
            const descriptionInput = document.getElementById('manualTrendDescription');
            const status = document.getElementById('manualTrendStatus');
            
            const title = titleInput.value.trim();
            const description = descriptionInput.value.trim();
            
            if (!title) {
                status.innerHTML = '<span style="color: red;">‚ö†Ô∏è Title is required</span>';
                titleInput.style.borderColor = '#ff4444';
                return;
            }
            
            titleInput.style.borderColor = '#e0e0e0';
            status.innerHTML = '<span style="color: #667eea;">‚è≥ Adding trend...</span>';
            
            try {
                const response = await fetch('/api/add-manual-trend', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, description })
                });
                const data = await response.json();
                
                if (data.success) {
                    status.innerHTML = '<span style="color: green;">‚úÖ Trend added!</span>';
                    titleInput.value = '';
                    descriptionInput.value = '';
                    
                    // Refresh the trends list
                    const trendsResponse = await fetch('/api/trends');
                    const trendsData = await trendsResponse.json();
                    trends = trendsData.trends;
                    displayTrends();
                    
                    setTimeout(() => { status.innerHTML = ''; }, 3000);
                } else {
                    status.innerHTML = '<span style="color: red;">‚ùå Error: ' + data.error + '</span>';
                }
            } catch (error) {
                status.innerHTML = '<span style="color: red;">‚ùå Error: ' + error.message + '</span>';
            }
        }
        
        function displayTrends() {
            const container = document.getElementById('trendsContainer');
            const actions = document.getElementById('trendActions');
            const selectTrendsSection = document.getElementById('selectTrendsSection');
            
            // Show the section when trends are displayed
            if (selectTrendsSection) {
                selectTrendsSection.style.display = 'block';
            }
            
            if (trends.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No trends available</p></div>';
                actions.style.display = 'none';
                return;
            }
            
            container.innerHTML = '<div class="trend-list">' + trends.map(trend => `
                <div class="trend-item" onclick="toggleTrend('${trend.trend_id}')">
                    <input type="checkbox" 
                           class="trend-checkbox" 
                           id="trend_${trend.trend_id}"
                           onclick="event.stopPropagation(); toggleTrend('${trend.trend_id}')">
                    <div class="trend-content">
                        <div class="trend-title">${trend.title}</div>
                        <div class="trend-meta">Source: ${trend.source} ‚Ä¢ ${new Date(trend.created_at).toLocaleString()}</div>
                    </div>
                </div>
            `).join('') + '</div>';
            
            actions.style.display = 'flex';
        }
        
        function toggleTrend(trendId) {
            const checkbox = document.getElementById('trend_' + trendId);
            const item = checkbox.closest('.trend-item');
            
            if (selectedTrendIds.has(trendId)) {
                selectedTrendIds.delete(trendId);
                checkbox.checked = false;
                item.classList.remove('selected');
            } else {
                selectedTrendIds.add(trendId);
                checkbox.checked = true;
                item.classList.add('selected');
            }
        }
        
        function selectAll() {
            trends.forEach(trend => {
                selectedTrendIds.add(trend.trend_id);
                const checkbox = document.getElementById('trend_' + trend.trend_id);
                const item = checkbox.closest('.trend-item');
                checkbox.checked = true;
                item.classList.add('selected');
            });
        }
        
        function deselectAll() {
            selectedTrendIds.clear();
            trends.forEach(trend => {
                const checkbox = document.getElementById('trend_' + trend.trend_id);
                const item = checkbox.closest('.trend-item');
                checkbox.checked = false;
                item.classList.remove('selected');
            });
        }
        
        async function matchSelected() {
            if (selectedTrendIds.size === 0) {
                alert('Please select at least one trend to match');
                return;
            }
            
            const btn = document.getElementById('matchBtn');
            const resultsSection = document.getElementById('resultsSection');
            const resultsContainer = document.getElementById('resultsContainer');
            const statsContainer = document.getElementById('statsContainer');
            const selectTrendsSection = document.getElementById('selectTrendsSection');
            
            // Collapse the select trends section when matching starts
            if (selectTrendsSection) {
                selectTrendsSection.style.display = 'none';
            }
            
            btn.disabled = true;
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '<div id="streamingLog" style="background: #f9f9f9; padding: 20px; border-radius: 8px; font-family: monospace; font-size: 0.9em; max-height: 500px; overflow-y: auto;"></div>';
            statsContainer.innerHTML = '';
            
            const streamingLog = document.getElementById('streamingLog');
            let allResults = [];
            let summary = { totalEvaluations: 0, accepted: 0, rejected: 0 };
            
            try {
                const response = await fetch('/api/match-selected', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ trendIds: Array.from(selectedTrendIds) })
                });
                
                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                
                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');
                    
                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = JSON.parse(line.substring(6));
                            
                            if (data.type === 'start') {
                                streamingLog.innerHTML += `<div style="color: #667eea; font-weight: bold; margin-bottom: 10px;">${data.message}</div>`;
                            } else if (data.type === 'trend') {
                                streamingLog.innerHTML += `<div style="color: #333; font-weight: bold; margin-top: 15px; margin-bottom: 5px;">${data.message}</div>`;
                            } else if (data.type === 'candidates') {
                                streamingLog.innerHTML += `<div style="color: #666; margin-left: 10px;">${data.message}</div>`;
                            } else if (data.type === 'accepted') {
                                streamingLog.innerHTML += `<div style="color: green; margin-left: 20px;">${data.message}</div>`;
                                allResults.push(data);
                            } else if (data.type === 'rejected') {
                                streamingLog.innerHTML += `<div style="color: #999; margin-left: 20px;">${data.message}</div>`;
                            } else if (data.type === 'complete') {
                                summary = data.summary;
                                allResults = data.results;
                                streamingLog.innerHTML += `<div style="color: #667eea; font-weight: bold; margin-top: 20px;">‚úÖ Matching complete!</div>`;
                            } else if (data.type === 'error') {
                                streamingLog.innerHTML += `<div style="color: red; margin-top: 10px;">‚ùå Error: ${data.error}</div>`;
                            }
                            
                            // Auto-scroll to bottom
                            streamingLog.scrollTop = streamingLog.scrollHeight;
                        }
                    }
                }
                
                // Display final results
                setTimeout(() => {
                    displayResults(summary, allResults);
                }, 1000);
                
            } catch (error) {
                resultsContainer.innerHTML = '<p style="color: red;">‚ùå Error: ' + error.message + '</p>';
            }
            
            btn.disabled = false;
        }
        
        function displayResults(summary, results) {
            const statsContainer = document.getElementById('statsContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${summary.totalEvaluations}</div>
                    <div class="stat-label">Total Evaluations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.accepted}</div>
                    <div class="stat-label">Accepted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${summary.rejected}</div>
                    <div class="stat-label">Rejected</div>
                </div>
            `;
            
            if (results.length === 0 || results.every(tr => tr.matchedVideos.length === 0)) {
                resultsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üö´</div>
                        <p><strong>No matches found</strong></p>
                        <p>The system rejected all matches as they didn't meet the strict criteria.</p>
                        <p style="margin-top: 10px; color: #666;">Try selecting different trends or adjust the video library.</p>
                    </div>
                `;
                return;
            }
            
            // Group results by trend
            resultsContainer.innerHTML = results.map((trendResult, trendIdx) => `
                <div style="margin-bottom: 40px; padding: 25px; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 12px; border: 2px solid #667eea;">
                    <!-- Trend Header -->
                    <div style="margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #667eea;">
                        <h2 style="color: #667eea; margin: 0; font-size: 1.5em;">
                            üìà Trend ${trendIdx + 1}: ${trendResult.trend.title}
                        </h2>
                        <div style="margin-top: 8px; color: #666; font-size: 0.95em;">
                            ${trendResult.matchedVideos.length} video(s) matched ‚Ä¢ ${trendResult.youtubeSuggestions.length} YouTube title suggestions
                        </div>
                    </div>

                    <!-- YouTube Title Suggestions Section -->
                    ${trendResult.youtubeSuggestions && trendResult.youtubeSuggestions.length > 0 ? `
                    <div style="margin-bottom: 30px; padding: 25px; background: linear-gradient(135deg, #FF000015 0%, #FF000025 100%); border-radius: 10px; border: 2px solid #FF0000; box-shadow: 0 4px 12px rgba(255,0,0,0.15);">
                        <h2 style="color: #FF0000; margin: 0 0 20px 0; font-size: 1.5em; display: flex; align-items: center; gap: 12px;">
                            <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                            üî• Top 10 YouTube Titles (Highest Views)
                        </h2>
                        <p style="margin: 0 0 20px 0; color: #666; font-size: 0.95em;">These are the actual top-performing videos on YouTube for this trend, sorted by view count.</p>
                        <div style="display: grid; gap: 15px;">
                            ${trendResult.youtubeSuggestions.map((yt, i) => `
                                <div style="padding: 12px; background: white; border-radius: 8px; border-left: 4px solid #FF0000; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">
                                    <div style="display: flex; align-items: start; gap: 15px;">
                                        <!-- Thumbnail -->
                                        <a href="https://youtube.com/watch?v=${yt.videoId}" target="_blank" style="text-decoration: none; flex-shrink: 0;">
                                            <img src="${yt.thumbnailUrl}" alt="${yt.title}" 
                                                 style="width: 160px; height: 90px; object-fit: cover; border-radius: 6px; display: block;">
                                        </a>
                                        
                                        <!-- Content -->
                                        <div style="flex: 1; min-width: 0;">
                                            <div style="font-weight: 600; color: #333; margin-bottom: 6px; font-size: 0.95em; line-height: 1.4;">
                                                ${i + 1}. ${yt.title}
                                            </div>
                                            <div style="font-size: 0.85em; color: #666; margin-bottom: 4px;">
                                                üì∫ ${yt.channelTitle} ‚Ä¢ üìÖ ${new Date(yt.publishedAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}
                                            </div>
                                            <div style="font-size: 0.85em; color: #888;">
                                                üëÅÔ∏è ${formatViews(yt.views)} views
                                            </div>
                                        </div>
                                        
                                        <!-- Small Watch Button -->
                                        <a href="https://youtube.com/watch?v=${yt.videoId}" target="_blank" 
                                           style="padding: 6px 12px; background: #f0f0f0; color: #666; text-decoration: none; border-radius: 4px; font-size: 0.8em; white-space: nowrap; border: 1px solid #ddd; align-self: center;">
                                            Watch ‚ñ∂
                                        </a>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    <!-- Matched Videos Section -->
                    ${trendResult.matchedVideos.length > 0 ? `
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 2px dashed #ccc;">
                        <h3 style="color: #667eea; margin: 0 0 10px 0; font-size: 1.1em;">
                            üìπ Your Matched Videos (Optional Repackaging Ideas)
                        </h3>
                        <p style="margin: 0 0 15px 0; color: #666; font-size: 0.85em;">These are videos from your library that could be repackaged for this trend.</p>
                        ${trendResult.matchedVideos.map((result, i) => `
                            <div class="result-item" style="margin-bottom: 20px;">
                                <div class="result-header">
                                    <div>
                                        <strong>${i + 1}. ${result.video}</strong>
                                    </div>
                                    <div class="score-badges">
                                        <span class="badge badge-success">Rel: ${(result.scores.semantic_relevance * 100).toFixed(0)}%</span>
                                        <span class="badge badge-success">Intro: ${(result.scores.intro_support * 100).toFixed(0)}%</span>
                                        <span class="badge ${result.scores.honesty_risk < 0.3 ? 'badge-success' : 'badge-warning'}">
                                            Risk: ${(result.scores.honesty_risk * 100).toFixed(0)}%
                                        </span>
                                    </div>
                                </div>
                                
                                ${result.video_intro ? `
                                <div style="margin-top: 15px; padding: 15px; background: #f0f4ff; border-radius: 6px; border-left: 3px solid #667eea;">
                                    <strong>üì∫ Video Intro (First 200 words):</strong>
                                    <div style="margin-top: 8px; color: #555; font-size: 0.9em; line-height: 1.6; max-height: 120px; overflow-y: auto;">
                                        ${result.video_intro.substring(0, 600)}${result.video_intro.length > 600 ? '...' : ''}
                                    </div>
                                </div>
                                ` : ''}
                                
                                <div style="margin-top: 15px; padding: 10px; background: #fff; border-radius: 6px;">
                                    <strong>üìù Repackaging Strategy:</strong> ${result.packaging.notes}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    ` : `
                    <div style="padding: 20px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107; color: #856404;">
                        <strong>‚ö†Ô∏è No videos matched for this trend</strong>
                        <p style="margin-top: 8px; margin-bottom: 0;">All candidates were rejected based on the strict matching criteria.</p>
                    </div>
                    `}
                </div>
            `).join('');
        }
        
        // Load trends on page load
        window.onload = async function() {
            try {
                const response = await fetch('/api/trends');
                const data = await response.json();
                if (data.success && data.trends.length > 0) {
                    trends = data.trends;
                    displayTrends();
                }
            } catch (error) {
                console.log('No existing trends found');
            }
        };
    </script>
</body>
</html>
